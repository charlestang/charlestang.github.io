---
title: WordPress 数据库损坏
tags:
  - WordPress
id: '1209'
categories:
  - - WordPress
date: 2023-03-10 02:08:46
---

常在河边走，哪能不湿鞋。没想到，从 2008 年开始深入玩 WordPress 博客到现在，竟然第一遇到了数据库损坏，真是闻所未闻，见所未见啊……一个个人博客而已，毫无访问和压力，竟然也可以搞成这样。

我不得不怀疑是阿里云搞得鬼。随便了。

现象是访问首页，展示错误信息，“建立数据库连接时出错”。诊断方法，我登录服务器，重启了 mysqld 服务和 php-fpm 服务，毕竟重启大法好，然后发现问题没有恢复。检查 php 配置文件，查看 mysqld 的服务端口，检查磁盘容量，基本没有什么异常现象。

尝试从 shell 直接登录 mysql，使用应用配置的用户名密码，竟然也完全正常，那么为什么就是连不上呢？然后我又到前台，访问了一下 wp-admin/ 目录，这时，展示了一个提示信息，告诉我数据库需要 repair。我摸不着头脑。

点了一下，提示我 repair 的方法，在 wp-config.php 文件中增加一行配置信息：

```php
define(‘WP_ALLOW_REPAIR’, true);
```

然后，刷新当前页面。我试了一下，果然出现了“修复数据库”，“修复并优化数据库”，我点击了后者，看到错误信息是，wp_options 表不知道怎么损坏了，原来 xx 行，现在 xx - 2 行。字面意思就是数据丢了两行。原因不详。

然后去前台刷新页面，熟悉的首页出来了。莫名奇妙。其实我最莫名其妙的，不是说这个东西会坏。而是我在同一台服务器上的三个博客，全挂了。死因完全一样，都是这个数据库建立连接时出错。

你说，三个博客各不相同，内容也不同，访问量也不同，怎么可能会死于完全相同的原因呢？访问压力什么的完全说不过去。黑客入侵也不像。所以，难道不是阿里云太垃圾么？