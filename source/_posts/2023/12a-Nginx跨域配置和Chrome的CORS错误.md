---
title: Nginx 跨域配置和Chrome 的 CORS 错误
permalink: 2023/nginx-cors-config/
categories:
  - - 工作相关
  - - 工作相关
    - 心得体会
tags:
  - nginx
  - usage
date: 2023-12-19 20:35:37
updated: 2023-12-26 23:22:04
---
最近，我完成了一个小项目，使用了当下比较时髦的 Vue 3 + TypeScript + Vite + Element Plus，采用前后端分离架构。为了减少对后端 API 的维护量，我将后端的 API 写在了主站的代码里。这样一来，前台网站的域名和后台网站的域名不同，就出现了跨域的问题。

## 跨域问题的由来

浏览器有一种安全策略，叫做同源策略。它是一种约定，可以防止网页上的 JS 脚本对其他网站的网页进行读取或者修改。这个策略的主要目的是保护用户的信息安全。

我们都知道，浏览器使用 Cookie 保存了用户的登录态，或者 Session ID 之类的信息。在一定时间段内，这些身份凭据并不会过期。而浏览器向服务器发送请求的时候，根据协议，会带上这些身份凭据。如果没有同源策略的约束，你在访问 A 网页的时候，网页上的脚本，往 B 服务器发送一个请求，同时携带了 B 服务器的身份凭据，这样一来，A 网页的恶意脚本，就以用户的名义，在 B 服务器执行了一些指令，从而损害了用户在 B 的利益。

上面的描述，其实就是跨站请求了，如果没有同源策略，则跨站请求会变得极其普遍。其实，CSRF 也是同样的原理。只是同源策略被堵上，并没有完全堵死。对于现在的 CSRF 来说，我们一般采用 CSRF-token 来防范，那是另一个话题了。

总之，我们需要理解的就是，对于一个合格浏览器来说，从一个特定域载入的 JS 脚本，是不能访问其他域的资源的。跨域的判定是非常严格的，比如 a.com 的脚本访问 b.a.com，虽然是子域，也被判定为跨域。反过来，也同样判定为跨域。

有了这样的策略保护，对于用户来说，当然是一件好事，但是对于开发者来说，比如我现在面临的情况，就很不方便了。我是正常开发业务的，但是也出现了服务器的域名和前台域名不同的情况。为了给这种情况提供方便，就出现了 CORS，跨域资源共享。

## CORS 跨域资源共享

CORS（Cross-Origin Resource Sharing，跨源资源共享）是一种安全机制，它允许一个网页的许多资源（例如字体、JavaScript等）可以被其他域名所访问。

当你尝试从一个不同的源（域名、协议或端口）访问资源时，浏览器会发送一个 CORS 预检请求，检查服务器是否允许跨源请求。如果服务器不允许，浏览器就会阻止请求，并在控制台中显示一个 CORS 错误。

要解决这个问题，你需要在服务器端设置相应的 CORS 头部，允许你的源访问资源。具体的设置方法取决于你的服务器软件和配置。如果你不能修改服务器设置（例如，你正在访问一个第三方 API），你可能需要使用一个代理来绕过 CORS 限制。

为了实现 CORS，你需要对 Web 服务器进行配置，在返回的 HTTP 请求头里，携带特定的 Header 信息，告知浏览器，允许进行跨域访问。

那么是怎么配置的呢？

```nginx

```