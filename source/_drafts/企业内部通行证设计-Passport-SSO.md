---
title: 企业内部通行证设计 Passport SSO
tags:
  - Architecture
id: '844'
categories:
  - - 日　　记
---

本文主要介绍一个企业内部通行证（Passport）系统需求演化和设计的过程和总结。

## 需求背景

互联网创业公司，从公司诞生之初，就在不断产生各种各样的内部系统，用来解决公司管理运转，业务经营运转等等方面信息化。我们公司成立五年，平均一个业务板块有 20 个左右的系统，累计接近 100 个内部系统。

为了业务安全，这些系统都必须使用身份认证和权限管理功能，也就是 Authentication & Authorization。我们起初的发展，是用 PHP 框架的脚手架直接生成了网站的用户密码表，以及配套的 ACL 功能。但是，当有了两个以及多个系统的时候，并不能复用同一套用户名密码和 ACL。只能是一个系统注册一次。为了方便，又有很多同事把自己在多个系统的帐号和密码注册成一模一样。这么做凑合了很久，一直到陆续有人离职，才发现，要回收帐号和密码变得极为困难。

业务系统由不同的业务团队开发和管理，以至于负责处理离职流程的同事，都搞不清应该去哪些业务部门检查遗留的帐号。如果忘记清退和关闭帐号，导致离职人员长期掌握公司帐号权限，带来很大的安全隐患。

于是，收敛公司内部员工帐号，成了一个重要的需求。利于统一分配和回收管理，另一方面，对于每个人来说，减少了注册帐号和记住密码的烦恼。按理说，现在企业微信，钉钉等等企业IM软件那么发达，也都有对应的开放API，实现一个统一扫码登录，很是简单，但是，我们公司还有子公司，子公司采用不同的主体独立经营，与母公司采用不同的主体，不同的企业微信，单纯的统一登录已经不能满足需求了。

## 功能性需求

1.  每个公司的员工，子公司的员工，都需要拥有通行证的帐号，通行证的帐号通过企业微信，钉钉等公司统一的 IM 软件帐号来同步，不允许直接注册。
2.  给公司所有的内部系统提供比较简单的 SDK，用于接入通行证鉴权，接入后，允许公司成员使用扫码登录。
3.  使用扫码登录一个网站后，再点击使用通行证登录，需要自动个进入。
4.  需要记住常用的电脑，在常用电脑上，不需要反复鉴权。
5.  记住常用登录地，如果异地登录需要重新鉴权。
6.  在一个内部网站退出登录的时候，需要退出通行证。