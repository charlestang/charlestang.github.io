---
title: Go 语言学习笔记（三）— 数组、切片
tags:
  - Go
id: '1127'
categories:
  - - something-about-daily-work
    - Go
---

Go 语言提供三种用于处理集合数据的结构：数组、切片和映射。

## 数组

数组是切片和映射的基础数据结构。数组是长度固定的数据类型，是用于存储相同类型的一段连续内存块。数组里存储的类型可以是内置类型，如整数和字符串，也可以是结构类型。

```null
var numbers [5]int
```

上面是声明一个空数组的代码范例，也可以使用数组字面量，来快速创建并初始化数组。数组可以多维。

```null
numbers := [...]int{1,2,3,4,5}
```

上面是使用字面量来创建并初始化一个数组的代码例子，使用 `...` 来代替长度 5，是让编译器自动确定数组的长度。

使用字面量创建数组的时候，也可以只指定特定下标的值。

```null
numbers := [5]int{1:2, 2:3}
// 得到的数组是 int{0, 2, 3, 0, 0}
```

没有指定的值的下标用默认值填充，所以都是 0。

数组是一个值，可以赋值给另一个数组。只有数组的元素类型和长度相同的数组，才能相互赋值。数组作为函数的参数传递的时候，整个数组会被复制。所以，使用数组作为函数的参数是一个代价很大的操作。可以使用数组的指针来作为参数传递，但是会导致数组内部的值在函数调用时被修改。

## 切片

切片是一个比较神奇的数据结构，我见过好几种语言，PHP，Python，Javascript，只在 Go 语言里见过切片。

### 创建切片

切片是一个包含 3 个字段的数据结构：指向底层数组的指针，访问元素的个数，切片允许增长到的元素个数。

```null
slice := make([]string, 3, 5)
```

可以使用 `make` 来创建一个切片，第二个参数是切片的长度，第三个参数是切片的容量。可以不指定容量，那么切片的长度和容量都等于第二个参数。容量不能小于长度。还可以使用切片字面量来创建切片，切片字面量和数组很像，但是不指定长度。

```null
slice := []string{"Red", "Green", "Blue"}
```

使用切片字面量也可以指定切片的长度和容量，比如创建一个长度 100 的切片：

```null
slice := []string{99: ""}
```

也可以声明或创建一个空切片：

```null
var slice []int          //创建 nil 切片
slice := make([]int, 0)  //空切片
slice := []int{}
```

nil 切片和空切片上调用 `append`、`len` 和 `cap` 效果都是一样的。

### 使用切片

使用下标可以给切片的元素赋值，这点和数组是一样的。

切片也可以再次切片生成新的切片：

```null
slice := []int{1,2,3,4,5}
slice[1] = 8 // slice 变成 {1, 8, 3, 4, 5}
newSlice := slice[1:3] // newSlice 成为一个长度为 2，容量为 4 的切片
```

使用 `append` 可以增长切片的长度，如果没有超出容量，则还共享原来的底层数组：

```null
newSlice = append(newSlice, 10)
// 这时候 slice 变成 {1, 8, 3, 10, 5}
```

如果底层数组没有可用的容量了，这时候在延长切片，会创建一个新的底层数组，然后将元素拷贝过去。

```null
newSlice = append(slice, 6)
// 这时候 newSlice = {1, 8, 3, 10, 5, 6}
slice[1] = 2
// 这时候 newSlice 仍然是 {1, 8, 3, 10, 5, 6}
```

对于以前没用过切片的人来说，这是一个很奇怪的设定，当你在使用切片的时候，必须时刻想着底层数组或者容量什么的内部原理，不然显然就会弄出很多的 bug 来。在上面的例子里，newSlice 的底层数组重建了，其容量变为原来的两倍，也即容量为 10。

从切片创建切片的时候，除了指定长度，还可以指定容量：

```null
slice := []int{1,2,3,4,5}
newSlice := slice[1:3] // newSlice 成为一个长度为 2，容量为 4 的切片
newSlice2:= slice[1:3:3] // newSlice 长度为 2，容量也为 2
```

注意，这样创建新切片的时候，指定的容量不能超过原底层数组的长度。如果将容量和长度限定到一样，第一次 `append` 新切片的时候，底层数组就会被重建并拷贝，从而和原来的切片分离开来。

切片作为函数的参数传递的时候，代价是比较小的，因为前面也说了，切片是三个字段构成的，一个指针，两个长度，在 64 位的机器上，固定只有 24 个字节长。